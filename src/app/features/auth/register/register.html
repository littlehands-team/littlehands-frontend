<div class="register-container">
  <!-- Header -->
  <div class="register-header">
    <h1 class="brand-title">MoneyMind</h1>
    <p class="subtitle">Crea tu cuenta nueva</p>

    <!-- Progress indicator -->
    <p class="step-text">Paso {{ currentStep }} de 2</p>
  </div>

  <!-- Formulario -->
  <form [formGroup]="registerForm" (ngSubmit)="onRegister()" class="register-form">

    <!-- PASO 1: Información Personal -->
    <div *ngIf="currentStep === 1" class="step-content">
      <h3 class="step-title">Información Personal</h3>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nombre</mat-label>
        <input matInput type="text" formControlName="firstName" placeholder="Tu nombre" required />
        <mat-error *ngIf="registerForm.get('firstName')?.hasError('required')">
          El nombre es obligatorio
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Apellido</mat-label>
        <input matInput type="text" formControlName="lastName" placeholder="Tu apellido" required />
        <mat-error *ngIf="registerForm.get('lastName')?.hasError('required')">
          El apellido es obligatorio
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Fecha de nacimiento</mat-label>
        <input matInput [matDatepicker]="picker" formControlName="birthDate" placeholder="DD/MM/AAAA" required readonly>
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error *ngIf="registerForm.get('birthDate')?.hasError('required')">
          La fecha de nacimiento es obligatoria
        </mat-error>
      </mat-form-field>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Género</mat-label>
        <mat-select formControlName="gender" required>
          <mat-option value="male">Masculino</mat-option>
          <mat-option value="female">Femenino</mat-option>
          <mat-option value="other">Otro</mat-option>
        </mat-select>
        <mat-error *ngIf="registerForm.get('gender')?.hasError('required')">
          El género es obligatorio
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email" placeholder="ejemplo@correo.com" required />
        <mat-error *ngIf="registerForm.get('email')?.hasError('required')">
          El correo es obligatorio
        </mat-error>
        <mat-error *ngIf="registerForm.get('email')?.hasError('email')">
          Ingresa un correo válido
        </mat-error>
      </mat-form-field>

      <button mat-flat-button class="register-btn" type="button"
              [disabled]="!isStep1Valid()"
              (click)="nextStep()">
        Continuar
      </button>
    </div>

    <!-- PASO 2: Información Financiera -->
    <div *ngIf="currentStep === 2" class="step-content">
      <h3 class="step-title">Información Financiera</h3>

      <mat-form-field appearance="outline" class="full-width how-many-money">
        <mat-label>¿Cuánto dinero tienes actualmente?</mat-label>
        <input matInput type="number" formControlName="currentMoney"
               placeholder="0" min="0" step="0.01" required />
        <span matPrefix class="prefix-simbol">S/. &nbsp;</span>
        <mat-error *ngIf="registerForm.get('currentMoney')?.hasError('required')">
          Este campo es obligatorio
        </mat-error>
        <mat-error *ngIf="registerForm.get('currentMoney')?.hasError('min')">
          El monto debe ser mayor o igual a 0
        </mat-error>
      </mat-form-field>

      <div class="income-section">
        <mat-checkbox formControlName="preferNotToSayIncome"
                      (change)="onIncomePreferenceChange($event)"
                      class="prefer-not-checkbox">
          Prefiero no decir mis ingresos mensuales ahora
        </mat-checkbox>

        <mat-form-field appearance="outline" class="full-width"
                        *ngIf="!registerForm.get('preferNotToSayIncome')?.value">
          <mat-label>¿Cuánto percibes mensualmente?</mat-label>
          <input matInput type="number" formControlName="monthlyIncome"
                 placeholder="0" min="0" step="0.01" />
          <span matPrefix class="prefix-simbol">S/. &nbsp;</span>
          <mat-hint>Campo opcional</mat-hint>
        </mat-form-field>
      </div>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Contraseña</mat-label>
        <input matInput type="password" formControlName="password" placeholder="Tu contraseña" required />
        <mat-error *ngIf="registerForm.get('password')?.hasError('required')">
          La contraseña es obligatoria
        </mat-error>
        <mat-error *ngIf="registerForm.get('password')?.hasError('minlength')">
          La contraseña debe tener al menos 6 caracteres
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Confirmar contraseña</mat-label>
        <input matInput type="password" formControlName="confirmPassword" placeholder="Repite tu contraseña" required />
        <mat-error *ngIf="registerForm.get('confirmPassword')?.hasError('required')">
          Debes confirmar la contraseña
        </mat-error>
        <mat-error *ngIf="registerForm.get('confirmPassword')?.hasError('passwordMismatch')">
          Las contraseñas no coinciden
        </mat-error>
      </mat-form-field>

      <div class="button-group">
        <button mat-flat-button class="back-btn" type="button" (click)="previousStep()">
          Volver
        </button>
        <button mat-flat-button class="register-btn" type="submit"
                [disabled]="!isStep2Valid()">
          Crear Cuenta
        </button>
      </div>
    </div>

    <div class="links-section" *ngIf="currentStep === 1">
      <p class="login-text">
        ¿Ya tienes cuenta?
        <a routerLink="/auth/login" class="login-link">Iniciar sesión</a>
      </p>
    </div>
  </form>
</div>
