<div class="profile-container">
  <h1 class="profile-title">MI CUENTA</h1>

  <div class="profile-content">
    <!-- Sidebar Menu -->
    <aside class="profile-sidebar">
      <div class="sidebar-title">MI CUENTA</div>

      <!-- Bot√≥n: Panel de control -->
      <button
        class="sidebar-item"
        [class.active]="activeSection === 'account'"
        (click)="setActiveSection('account')">
        ‚ñ∏ PANEL DE CONTROL
      </button>

      <!-- üîí Solo visible para administradores -->
      <ng-container *ngIf="userInfo?.role === 'admin'">
        <!-- Bot√≥n: Productos -->
        <button
          class="sidebar-item"
          [class.active]="activeSection === 'products'"
          (click)="setActiveSection('products')">
          ‚ñ∏ PRODUCTOS
        </button>

      </ng-container>

      <button
        class="sidebar-item"
        (click)="logOut()">
        ‚ñ∏ CERRAR SESI√ìN
      </button>
    </aside>

    <!-- Main Content -->
    <main class="profile-main">
      <!-- Account Information Section -->
      <div *ngIf="activeSection === 'account'" class="account-section">
        <h2 class="section-title">MI CUENTA</h2>

        <div class="info-card">
          <h3 class="card-subtitle">INFORMACI√ìN DE LA CUENTA</h3>

          <div class="info-group">
            <p class="info-label">Informaci√≥n del contacto</p>
            <p class="info-value">{{ userInfo?.first_name }} {{ userInfo?.last_name }}</p>
            <p class="info-value">{{ userInfo?.email }}</p>

            <!--div class="action-links">
              <button class="link-button" (click)="onEdit()">Editar</button>
              <span class="separator">|</span>
              <button class="link-button" (click)="onChangePassword()">Cambiar la contrase√±a</button>
            </div-->
          </div>

          <div class="info-group">
            <h4 class="subsection-title">LIBRETA DE DIRECCIONES</h4>
            <button class="manage-button">GESTIONAR DIRECCIONES</button>

            <div class="address-columns">
              <div class="address-column">
                <p class="address-label">Direcci√≥n de facturaci√≥n por defecto</p>
                <p class="address-text">No ha establecido una direcci√≥n de facturaci√≥n predeterminada.</p>
                <button class="link-button">Editar direcci√≥n</button>
              </div>

              <div class="address-column">
                <p class="address-label">Direcci√≥n de env√≠o predeterminada</p>
                <p class="address-text">No ha establecido una direcci√≥n de env√≠o predeterminada.</p>
                <button class="link-button">Editar direcci√≥n</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Products Section (Solo Admin) -->
      <div *ngIf="activeSection === 'products'" class="products-section">
        <h2 class="section-title">GESTI√ìN DE PRODUCTOS</h2>
        <div class="products-header">
          <button class="add-product-button" (click)="openProductDialog()">
            <mat-icon>add</mat-icon>
            AGREGAR PRODUCTO
          </button>
        </div>

        <!-- üåÄ Spinner visible mientras carga -->
        <div class="loading-container" *ngIf="isProductsListLoading">
          <mat-spinner diameter="50" color="accent"></mat-spinner>
          <p>Cargando productos...</p>
        </div>

        <div class="products-table-container" *ngIf="!isProductsListLoading">
          <table mat-table [dataSource]="products" class="products-table">

            <!-- Name Column -->
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Nombre</th>
              <td mat-cell *matCellDef="let product">{{ product.name }}</td>
            </ng-container>

            <!-- Price Column -->
            <ng-container matColumnDef="price">
              <th mat-header-cell *matHeaderCellDef>Precio</th>
              <td mat-cell *matCellDef="let product">S/ {{ product.price }}</td>
            </ng-container>

            <!-- Discount Column -->
            <ng-container matColumnDef="discount">
              <th mat-header-cell *matHeaderCellDef>Descuento</th>
              <td mat-cell *matCellDef="let product">
          <span class="discount-badge" *ngIf="product.discount_percentage > 0">
            {{ product.discount_percentage }}%
          </span>
                <span *ngIf="product.discount_percentage === 0">-</span>
              </td>
            </ng-container>

            <!-- Final Price Column -->
            <ng-container matColumnDef="finalPrice">
              <th mat-header-cell *matHeaderCellDef>Precio Final</th>
              <td mat-cell *matCellDef="let product">
                <span class="final-price">
                  S/ {{ calculateFinalPrice(product) | number:'1.2-2' }}
                </span>
              </td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Estado</th>
              <td mat-cell *matCellDef="let product">
                <span class="status-badge" [class.active]="product.is_active" [class.inactive]="!product.is_active">
                  {{ product.is_active ? 'Activo' : 'Inactivo' }}
                </span>
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Acciones</th>
              <td mat-cell *matCellDef="let product">
                <div class="action-buttons">
                  <button mat-icon-button (click)="viewProduct(product)" matTooltip="Ver producto" >
                    <mat-icon>visibility</mat-icon>
                  </button>
                  <button mat-icon-button (click)="editProduct(product)" matTooltip="Editar" >
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button mat-icon-button (click)="toggleProductStatus(product)"
                          [matTooltip]="product.is_active ? 'Desactivar' : 'Activar'">
                    <mat-icon>{{ product.is_active ? 'toggle_on' : 'toggle_off' }}</mat-icon>
                  </button>
                  <button mat-icon-button (click)="deleteProduct(product)" matTooltip="Eliminar" class="delete-btn">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>

          <!-- ü™∂ Mensaje si no hay productos -->
          <div *ngIf="products.length === 0" class="empty-products">
            <mat-icon>inventory_2</mat-icon>
            <p>No hay productos registrados.</p>
            <button class="add-first-product" (click)="openProductDialog()">
              Agregar primer producto
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>
